<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>John Andrew Kunze ‚Äì Biography ‚Äì jkunze</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a14e3238c51140e99ccc48519b6ed9ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">jkunze</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">John Andrew Kunze ‚Äì Biography</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<table class="caption-top table" data-quarto-postprocess="true">
<colgroup>
<col style="width: 15%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td style="vertical-align: middle; width: 22%"><img src="assets/jk_2025_hd.png" title="Photo of John Andrew Kunze, April 2025" class="img-fluid" width="200"></td>
<td style="align: middle; vertical-align: middle; width: 76%; line-height: 1.8"><center>
<a href="https://mrc.cci.drexel.edu" rel="me">Metadata Research Center</a>, Drexel University<br>
3141 Chestnut Street Philadelphia, PA 19104, USA<br>
<a href="cv.html" rel="me">Curriculum Vitae</a> &nbsp;&nbsp;|&nbsp; ORCID: <a href="https://orcid.org/0000-0001-7604-8041" rel="me">0000-0001-7604-8041</a><br>
Linkedin: <a href="https://linkedin.com/in/jakkbl" rel="me">linkedin.com/in/jakkbl</a> &nbsp;|&nbsp; Github: <a href="https://github.com/jkunze" rel="me">jkunze</a><br>
Mastodon: <a href="https://fosstodon.org/@jakkbl" rel="me">fosstodon.org/@jakkbl</a> &nbsp;|&nbsp; Bluesky: <a href="https://bsky.app/profile/jakkbl.bsky.social" rel="me">jakkbl.bsky.social</a><br>
<a href="index.html" rel="me">jkunze.net</a> &nbsp;|&nbsp; <a href="https://arks.org" rel="me">ARK Alliance</a>
</center></td>
</tr>
</tbody>
</table>


<!-- Audio Elements - Preload for quicker playback -->
<audio id="ipa_Kunze" preload="auto">
    <source src="assets/ipa_Kunze.mp3" type="audio/mpeg">
    <source src="assets/ipa_Kunze.ogg" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<audio id="ipa_Infocal" preload="auto">
    <source src="assets/ipa_Infocal.mp3" type="audio/mpeg">
    <source src="assets/ipa_Infocal.ogg" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<audio id="ipa_Noid" preload="auto">
    <source src="assets/ipa_Noid.mp3" type="audio/mpeg">
    <source src="assets/ipa_Noid.ogg" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<audio id="ipa_EZID" preload="auto">
    <source src="assets/ipa_EZID.mp3" type="audio/mpeg">
    <source src="assets/ipa_EZID.ogg" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<audio id="ipa_URL" preload="auto">
    <source src="assets/ipa_URL.mp3" type="audio/mpeg">
    <source src="assets/ipa_URL.ogg" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<script>
    function playAudio(audioId) {
        const audioEl = document.getElementById(audioId);
        // Reset time to the start in case it was stopped midway
        audioEl.currentTime = 0;
        // Play the selected audio file
        audioEl.play();
    }
</script>
<p>John Kunze is a pioneer in the theory and practice of digital libraries. His passion for creating and sharing free, open, pragmatic digital solutions has guided his long public sector career. As a Berkeley undergrad in computer science and mathematics, he wrote software that comes pre-installed in every Mac and Linux system. He had leading roles in establishing identifier standards (URL, ARK), metadata standards (Dublin Core), archiving standards (BagIt, WARC), the Z39.50 library protocol, UC Berkeley‚Äôs first Campus Wide Information System, and repository microservices used in HathTrust and OCFL. He is currently leading the <a href="https://arks.org">ARK Alliance</a> forward and serving as a senior research associate at Drexel University, where he is working on the crowdsourced vocabulary tool, <a href="https://yamz.net">yamz.net</a>.</p>
<ul>
<li><p>Participating in open source at the University of California (UC) Berkeley from 1978-1983, 20 years before that term was coined, Kunze* began fixing BSD Unix bugs and writing tools that come pre-installed in today‚Äôs Mac and Linux systems (<a href="https://man.openbsd.org/jot.1">jot</a>, <a href="https://man.openbsd.org/lam.1">lam</a>, <a href="https://man.openbsd.org/rs.1">rs</a>). During that time he maintained the global terminal capability database (<a href="https://man.openbsd.org/termcap.5">termcap</a>), created an online Unix help system, brought the Bell Labs Unix ‚Äú<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/learn/learn.html">learn</a>‚Äù program and its computer-aided instruction scripts to life, and became principal author of the book <a href="https://n2t.net/ark:/13960/t68350d1q">Common Lisp: the Reference</a>. Realizing that content is king in information technology, he became interested in working with libraries and archives.</p></li>
<li><p>In 1989 he proposed and began creating UC Berkeley‚Äôs first Campus Wide Information System (CWIS).‚Ä† Into that system, called <a href="https://n2t.net/ark:/13960/s2mr5mfz7g9">Infocal</a>, he built in pre-web hypertext navigation (inspired by ‚Äúlearn‚Äù scripts), a custom search engine, and open access to (a) library catalog search via the then-new Z39.50 search and retrieval protocol, (b) major campus datasets previously available only on paper (course catalog, schedule of classes, phone directory, job vacancies), and (c) the World Wide Web. Interoperation with Z39.50 had never been demonstrated previously, requiring a heavy investment in several areas. This work included standards development, software development ‚Äì resulting in the release of the first complete open-source client-server codebase ‚Äì and the first true interoperability demonstration, conducted between UC Berkeley, Penn State University, and the UC Division of Library Automation.</p></li>
<li><p>As Infocal became web-aware, Kunze began to work with identifier standards. In 1994 he declined principal editorship of the URL specification, and instead <a href="https://www.ietf.org/proceedings/28.pdf">agreed to write</a> the functional requirements in an attempt to unblock the URL standard, which was at an impasse because the average URL link (web address) was seen to break (stop working) after about 44 days. His proposed standard permitted URLs to break and was published as <a href="https://www.ietf.org/rfc/rfc1736">RFC1736</a>, resulting in the immediate approval of the first URL standard as <a href="https://www.ietf.org/rfc/rfc1738">RFC1738</a>. As part of a 3-year fellowship at the US National Library of Medicine (NLM), he analyzed the persistent identifier landscape and in 2000 defined the framework for the NLM multi-dimensional <a href="https://n2t.net/ark:/13960/s2kk13d8kdh">permanence levels</a>.</p></li>
<li><p>To counter the flood of broken URLs, Kunze created the <a href="https://n2t.net/ark:/13030/c7n00zt1z">ARK (Archival Resource Key)</a> persistent identifier scheme in 2001 at the California Digital Library (CDL). With the goal of addressing broken links flexibly and affordably while leveraging the NLM permanence levels, he evolved the <a href="https://datatracker.ietf.org/doc/draft-kunze-ark/">ARK specification</a>, created the ARK resolver and registration infrastructure, and registered the first 600 ARK organizations. In 2018 with help from DuraSpace, he led the creation and growth of the ARK Alliance (<a href="https://arks.org">arks.org</a>). By the end of 2025, there were over 1720 ARK organizations, including 12 national libraries, 215 universities, 254 archives, 144 museums, 124 journals, and 59 scientific centers. The non-paywalled ARK identifier is vital for open knowledge linking across world cultural and scientific institutions, especially in the global South.</p></li>
<li><p>Motivated by the Unix philosophy favoring simple, extensible tools that combine easily and by a distaste for siloed solutions, Kunze developed open source tools for ARKs that also work for non-ARK identifiers. The Name-to-Thing (<a href="https://n2t.net">N2T.net</a>) resolver supports hundreds of <a href="https://doi.org/10.1038/sdata.2018.29">compact identifier schemes</a>, the <a href="https://www.slideshare.net/slideshow/ezid-easy/9978331">EZID identifier service</a> supports ARKs and DOIs (URNs, PURLs, and IGSNs were planned), the <a href="https://metacpan.org/dist/Noid/view/noid">Noid (Nice Opaque Identifier) Tool</a> mints billions of ARK and Handle identifiers, and <a href="https://datatracker.ietf.org/doc/draft-kunze-thump/">THUMP</a> specifies inflections for ARKs that work with any URL-based identifiers. He also co-authored <a href="https://www.ietf.org/rfc/rfc1625">RFC1625</a> (WAIS) and <a href="https://www.ietf.org/rfc/rfc2056">RFC2056</a> (Z39.50 URLs).</p></li>
<li><p>A key takeaway from his protocol interoperability work, especially for <a href="https://uh-ir.tdl.org/items/c12d000a-5b3d-4df3-868f-9f64033f0e96">nonbibliographic applications</a>, was the notion of shared attributes such as title, author, and date. This inspired him to propose the Uniform Resource Citation (<a href="https://n2t.net/ark:/13960/s218wxzv0w5">URC</a>) in 1992 and to join the Dublin Core initiative in 1995 to focus on a new thing being called metadata.‚Ä° There he led publication of the world‚Äôs first metadata standards (<a href="https://www.ietf.org/rfc/rfc2413">RFC2413</a>, <a href="https://www.ietf.org/rfc/rfc2731">RFC2731</a>, <a href="https://webstore.ansi.org/preview-pages/NISO/preview_ANSI+NISO+Z39.85-2001.pdf">ANSI/NISO Z39.85</a>), upon which most metadata schemas are based: Schema.org, OAI-PMH, MODS, METS, EPUB, DataCite, Darwin Core, etc. Considering metadata to be far from finished, he created the minimalist <a href="https://n2t.net/ark:/13030/c7rr1pm49">Dublin Kernel</a> based on his Z39.50 work, the <a href="https://datatracker.ietf.org/doc/draft-kunze-temper/">TEMPER date format</a>, and a vision (1996) of a kind of <a href="https://figshare.com/articles/journal_contribution/A_Unified_Element_Vocabulary_for_Metadata/5212459?file=8901253">‚ÄúDublin Mantle‚Äù</a> that he that he would later implement as the <a href="https://n2t.net/ark:/13960/s2zg7dwqz6t">YAMZ.net vocabulary builder</a>.</p></li>
<li><p>In 2003 Kunze wrote the vision for a Library of Congress (LC) grant to harvest and preserve at-risk websites. Under that grant, he published the <a href="https://datatracker.ietf.org/doc/draft-kunze-warc/">first draft of the WARC standard</a>, now used in all large-scale web archiving (e.g., Internet Archive). To move files between archives, he worked with the LC team as principal author of the BagIt standard (<a href="https://www.ietf.org/rfc/rfc8493">RFC8493</a>), which is widely deployed in libraries and archives (LC, Stanford, Cornell, Dryad, etc). He also created repository microservice specifications used in HathiTrust (<a href="https://datatracker.ietf.org/doc/draft-kunze-pairtree/">Pairtree</a>), BagIt (<a href="https://datatracker.ietf.org/doc/draft-kunze-oxum/">Oxum</a>), and <a href="https://ocfl.io/">OCFL</a> (<a href="https://ocfl.io/draft/implementation-notes/">Namaste</a>).</p></li>
</ul>
<p><br></p>
<hr>
<p>* <a href="https://www.leskoff.com/s01763-0">IPA</a> pronunciation links üîä: Kunze /<a href="#" onclick="playAudio('ipa_Kunze'); return false;">Ààk änziÀê</a>/, Infocal /<a href="#" onclick="playAudio('ipa_Infocal'); return false;">Àà…™nf…ô äk√¶l</a>/, Noid /<a href="#" onclick="playAudio('ipa_Noid'); return false;">n…î…™d</a>/, EZID /<a href="#" onclick="playAudio('ipa_EZID'); return false;">iÀêÀåziÀêa…™ÀådiÀê</a>/, URL /<a href="#" onclick="playAudio('ipa_URL'); return false;">juÀê…ëÀê…π…õl</a>/ <br> ‚Ä† Not everyone knows that a few years before the web appeared, dozens of custom-built state-of-the-art <a href="https://datatracker.ietf.org/doc/rfc1402">networked information systems</a> were emerging at universities for the purpose of sharing diverse types of information with students, faculty, staff, and the general public. In this brief era of the <a href="https://search.syr.edu/permalink/01SYU_INST/1gbpq8j/alma9911067813408496">Campus Wide Information System (CWIS)</a>, institutions of higher education effectively piloted the web insofar as they worked out presentation and maintenance of heterogeneous online data over network protocols such as FTP, NNTP, Z39.50, and Gopher. From the University of Minnesota, Gopher was the first CWIS software packaged for easy installation, and just as thousands of non-campus sites were adopting it, the WWW software‚Äôs winning hypertext capability overtook it. <br> ‚Ä° This usage likely comes from the <a href="https://n2t.net/ark:/13960/s2tzhp9p6c1">1993 IETF URI Working Group meeting</a> (p.&nbsp;556) next to Dublin, Ohio: ‚ÄòTim Berners-Lee, John Kunze and Michael Mealling made presentations as to how to handle this ‚Äúmeta data‚Äù or ‚Äùfactoids.‚Äù‚Äô <!-- used capyschool.com/en/reader/ for IPA to mp3 file;
     provider Amazon, en-US, type neural, voice Joanna;
     https://www.freeconvert.com/mp3-to-ogg/download for ogg --></p>
<hr>
<!--
<li><a href="checkmspec.html">Checkm: a checksum-based manifest format</a>
-->



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/jkunze\.net");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>